<!DOCTYPE html>
<html>
        <head>
    <title>CQL : Creating a column family</title>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta name="description" content="Following on from my last post about how to create a keyspace with CQL,  in this tutorial/post I&#39;ll create a Coloumn family. Unless this has changed rece...">
    <meta name="keywords" content="" />
    <script src="/js/jquery.min.js"></script>
    <script src="/js/init.js"></script>

    <link rel="stylesheet" href="/css/main.css">

    <link rel="canonical" href="//2011/06/18/cql-creating-a-column-family">
    <link rel="alternate" type="application/atom+xml" title="zcourts AKA Courtney Robinson" href="/feed.xml" />
</head>
    <body>
        <!-- Header -->
<div id="header" class="skel-layers-fixed">

    <div class="top">

        <!-- Logo -->
        <div id="logo">
            <span class="image avatar48"><img src="/images/avatar.jpg" alt=""/></span>

            <h1 id="title">zcourts</h1>
            <p>Courtney Robinson</p>
            <p>Software Engineer</p>
            <p>PhD Student</p>
        </div>

        <!-- Nav -->
        <nav id="nav">
            <!--

                Prologue's nav expects links in one of two formats:

                1. Hash link (scrolls to a different section within the page)

                   <li><a href="#foobar" id="foobar-link" class="icon fa-whatever-icon-you-want skel-layers-ignoreHref"><span class="label">Foobar</span></a></li>

                2. Standard link (sends the user to another page/site)

                   <li><a href="http://foobar.tld" id="foobar-link" class="icon fa-whatever-icon-you-want"><span class="label">Foobar</span></a></li>

            -->
            <ul>
                <li><a href="/#top" id="top-link" class="skel-layers-ignoreHref"><span class="icon fa-home">Home</span></a></li>
                <li><a href="/#portfolio" id="portfolio-link" class="skel-layers-ignoreHref"><span class="icon fa-th">Projects</span></a></li>
                <li><a href="/posts" id="blog-link" class="skel-layers-ignoreHref"><span class=" glyphicon glyphicon-comment">Blog posts</span></a></li>
                <li><a href="/categories.html" id="cat-link" class="skel-layers-ignoreHref"><span class=" glyphicon glyphicon-tags">Categories</span></a></li>
                <li><a href="/about-courtney-robinson" id="about-link" class="skel-layers-ignoreHref"><span class="icon fa-user">About Me</span></a></li>
                <li><a href="/#contact" id="contact-link" class="skel-layers-ignoreHref"><span class="icon fa-envelope">Contact</span></a></li>
            </ul>
        </nav>

    </div>

    <div class="bottom">

        <!-- Social Icons -->
        <ul class="icons">
            <li><a href="https://twitter.com/zcourts" class="icon fa-twitter"><span class="label">Twitter</span></a></li>
            <li><a href="https://www.facebook.com/zcourts" class="icon fa-facebook"><span class="label">Facebook</span></a></li>
            <li><a href="https://github.com/zcourts" class="icon fa-github"><span class="label">Github</span></a></li>
            <li><a href="mailto:site@crlog.info" class="icon fa-envelope"><span class="label">Email</span></a></li>
        </ul>

    </div>

</div>
        <!-- Main -->
        <div id="main">
            <div class="post">

  <header class="post-header">
    <h1 class="post-title">CQL : Creating a column family</h1>
    <p class="post-meta">Jun 18, 2011 • zcourts</p>
  </header>

  <article class="post-content">
    <p>Following on from my last post about how to <a href="http://crlog.info/2011/06/13/cql-creating-a-simple-keyspace/">create a keyspace with CQL</a>,  in this tutorial/post I&#39;ll create a Coloumn family. Unless this has changed recently CQL does not support creating supoer column families. As far as I know there are no plans to do so either...&lt;!-- more --&gt;</p>

<p>Here goes:</p>
<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="kn">import</span> <span class="nn">java.io.UnsupportedEncodingException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.nio.ByteBuffer</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.cassandra.thrift.Cassandra</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.cassandra.thrift.Cassandra.Client</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.cassandra.thrift.Compression</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.cassandra.thrift.InvalidRequestException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.cassandra.thrift.NotFoundException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.cassandra.thrift.SchemaDisagreementException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.cassandra.thrift.TimedOutException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.cassandra.thrift.UnavailableException</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.apache.thrift.transport.TTransport</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.thrift.transport.TFramedTransport</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.thrift.transport.TSocket</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.thrift.protocol.TProtocol</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.thrift.protocol.TBinaryProtocol</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.thrift.TException</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">CqlTests</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="n">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span>
            <span class="kd">throws</span> <span class="n">TException</span><span class="o">,</span> <span class="n">InvalidRequestException</span><span class="o">,</span> <span class="n">UnavailableException</span><span class="o">,</span> <span class="n">UnsupportedEncodingException</span><span class="o">,</span> <span class="n">NotFoundException</span><span class="o">,</span> <span class="n">TimedOutException</span><span class="o">,</span> <span class="n">SchemaDisagreementException</span> <span class="o">{</span>
        <span class="n">TTransport</span> <span class="n">tr</span> <span class="o">=</span> <span class="k">new</span> <span class="n">TFramedTransport</span><span class="o">(</span><span class="k">new</span> <span class="n">TSocket</span><span class="o">(</span><span class="s">"localhost"</span><span class="o">,</span> <span class="mi">9160</span><span class="o">));</span>
        <span class="n">TProtocol</span> <span class="n">proto</span> <span class="o">=</span> <span class="k">new</span> <span class="n">TBinaryProtocol</span><span class="o">(</span><span class="n">tr</span><span class="o">);</span>
        <span class="n">Cassandra</span><span class="o">.</span><span class="na">Client</span> <span class="n">client</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Cassandra</span><span class="o">.</span><span class="na">Client</span><span class="o">(</span><span class="n">proto</span><span class="o">);</span>
        <span class="n">tr</span><span class="o">.</span><span class="na">open</span><span class="o">();</span>
        <span class="n">String</span> <span class="n">cql</span> <span class="o">=</span> <span class="s">"USE test;"</span><span class="o">;</span>
        <span class="n">query</span><span class="o">(</span><span class="n">client</span><span class="o">,</span> <span class="n">cql</span><span class="o">);</span>
        <span class="n">cql</span> <span class="o">=</span> <span class="s">"CREATE COLUMNFAMILY sample (KEY bytea PRIMARY KEY);"</span><span class="o">;</span>
        <span class="n">query</span><span class="o">(</span><span class="n">client</span><span class="o">,</span> <span class="n">cql</span><span class="o">);</span>
        <span class="n">tr</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="kd">static</span> <span class="kt">void</span> <span class="n">query</span><span class="o">(</span><span class="n">Client</span> <span class="n">client</span><span class="o">,</span> <span class="n">String</span> <span class="n">cql</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">SchemaDisagreementException</span><span class="o">,</span> <span class="n">InvalidRequestException</span><span class="o">,</span> <span class="n">UnavailableException</span><span class="o">,</span> <span class="n">TException</span><span class="o">,</span> <span class="n">TimedOutException</span> <span class="o">{</span>
        <span class="n">client</span><span class="o">.</span><span class="na">execute_cql_query</span><span class="o">(</span><span class="n">ByteBuffer</span><span class="o">.</span><span class="na">wrap</span><span class="o">(</span><span class="n">cql</span><span class="o">.</span><span class="na">getBytes</span><span class="o">()),</span> <span class="n">Compression</span><span class="o">.</span><span class="na">NONE</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div>
<p>In the above code demonstrates the minimum you need, the Column family name and the key type. The available column types are available at <a href="http://crlog.info/2011/06/13/cassandra-query-language-cql-v1-0-0-updated/#CREATE+COLUMNFAMILY">http://crlog.info/2011/06/13/cassandra-query-language-cql-v1-0-0-updated/#CREATE+COLUMNFAMILY
I</a>f you now use the Cassandra-cli you can see the details of the keyspace/column family using the &quot;show keyspaces;&quot; command:</p>
<div class="highlight"><pre><code class="language-" data-lang="">Keyspace: test:
  Replication Strategy: org.apache.cassandra.locator.NetworkTopologyStrategy
    Options: [DC1:1]
  Column Families:
    ColumnFamily: sample
      Key Validation Class: org.apache.cassandra.db.marshal.BytesType
      Default column value validator: org.apache.cassandra.db.marshal.UTF8Type
      Columns sorted by: org.apache.cassandra.db.marshal.UTF8Type
      Row cache size / save period in seconds: 0.0/0
      Key cache size / save period in seconds: 200000.0/14400
      Memtable thresholds: 0.2953125/63/1440 (millions of ops/MB/minutes)
      GC grace seconds: 864000
      Compaction min/max thresholds: 4/32
      Read repair chance: 1.0
      Replicate on write: true
      Built indexes: []
</code></pre></div>
<p>It creates the column family with the default values shown above. Some of these may not
be desirable for your use case so CQL allows you to customize your column family to your heart&#39;s content.
For example, you could easily change the CQL statement above to look something like this:
CQL:
CREATE COLUMNFAMILY sample1 ( KEY uuid PRIMARY KEY, &#39;username&#39; text,  &#39;age&#39; varint, &#39;birthdate&#39; bigint, &#39;id&#39; uuid ) WITH comment = &#39;shiny, new, cf&#39; AND default_validation = ascii;
Now using the CLI again you&#39;ll see something similar to:</p>
<div class="highlight"><pre><code class="language-" data-lang="">    ColumnFamily: sample1
    "shiny, new, cf"
      Key Validation Class: org.apache.cassandra.db.marshal.UUIDType
      Default column value validator: org.apache.cassandra.db.marshal.AsciiType
      Columns sorted by: org.apache.cassandra.db.marshal.UTF8Type
      Row cache size / save period in seconds: 0.0/0
      Key cache size / save period in seconds: 200000.0/14400
      Memtable thresholds: 0.2953125/63/1440 (millions of ops/MB/minutes)
      GC grace seconds: 864000
      Compaction min/max thresholds: 4/32
      Read repair chance: 1.0
      Replicate on write: true
      Built indexes: []
      Column Metadata:
        Column Name: birthdate
          Validation Class: org.apache.cassandra.db.marshal.LongType
        Column Name: id
          Validation Class: org.apache.cassandra.db.marshal.UUIDType
        Column Name: username
          Validation Class: org.apache.cassandra.db.marshal.UTF8Type
        Column Name: age
          Validation Class: org.apache.cassandra.db.marshal.IntegerType
</code></pre></div>
<p>The options that can be specified are all available <a href="http://crlog.info/2011/06/13/cassandra-query-language-cql-v1-0-0-updated/#CREATE+COLUMNFAMILY">http://crlog.info/2011/06/13/cassandra-query-language-cql-v1-0-0-updated/#CREATE+COLUMNFAMILY</a>
I&#39;d copied some for creating a keyspace into my last post but there are too many for creating CFs so have a look at the link
above it&#39;ll show you the options available.</p>

  </article>

</div>

        </div>
        <!-- Footer -->
<div id="footer">
    <!-- Copyright -->
    <ul class="copyright">
        <li><a href="http://zcourts.com">&copy; zcourts</a></li>
        <li>i.e. &copy; Courtney Robinson. All rights reserved.</li>
    </ul>

</div>
        <script>
            (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
                (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
                    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
            })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

            ga('create', 'UA-46289473-4', 'auto');
            ga('require', 'linkid', 'linkid.js');
            ga('send', 'pageview');

        </script>
    </body>
</html>
