<!DOCTYPE html>
<html>
        <head>
    <title>CQL : Creating a simple keyspace </title>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta name="description" content="I promised a few tutorials covering CQL examples so I&#39;m going to kick off a series to demonstrate all/most of the features of Cassandra&#39;s new query l...">
    <meta name="keywords" content="" />
    <script src="/js/jquery.min.js"></script>
    <script src="/js/init.js"></script>

    <link rel="stylesheet" href="/css/main.css">

    <link rel="canonical" href="//2011/06/14/cql-creating-a-simple-keyspace">
    <link rel="alternate" type="application/atom+xml" title="zcourts AKA Courtney Robinson" href="/feed.xml" />
</head>
    <body>
        <!-- Header -->
<div id="header" class="skel-layers-fixed">

    <div class="top">

        <!-- Logo -->
        <div id="logo">
            <span class="image avatar48"><img src="/images/avatar.jpg" alt=""/></span>

            <h1 id="title">zcourts</h1>
            <p>Courtney Robinson</p>
            <p>Software Engineer</p>
            <p>PhD Student</p>
        </div>

        <!-- Nav -->
        <nav id="nav">
            <!--

                Prologue's nav expects links in one of two formats:

                1. Hash link (scrolls to a different section within the page)

                   <li><a href="#foobar" id="foobar-link" class="icon fa-whatever-icon-you-want skel-layers-ignoreHref"><span class="label">Foobar</span></a></li>

                2. Standard link (sends the user to another page/site)

                   <li><a href="http://foobar.tld" id="foobar-link" class="icon fa-whatever-icon-you-want"><span class="label">Foobar</span></a></li>

            -->
            <ul>
                <li><a href="/#top" id="top-link" class="skel-layers-ignoreHref"><span class="icon fa-home">Home</span></a></li>
                <li><a href="/#portfolio" id="portfolio-link" class="skel-layers-ignoreHref"><span class="icon fa-th">Projects</span></a></li>
                <li><a href="/posts" id="blog-link" class="skel-layers-ignoreHref"><span class=" glyphicon glyphicon-comment">Blog posts</span></a></li>
                <li><a href="/categories.html" id="cat-link" class="skel-layers-ignoreHref"><span class=" glyphicon glyphicon-tags">Categories</span></a></li>
                <li><a href="/about-courtney-robinson" id="about-link" class="skel-layers-ignoreHref"><span class="icon fa-user">About Me</span></a></li>
                <li><a href="/#contact" id="contact-link" class="skel-layers-ignoreHref"><span class="icon fa-envelope">Contact</span></a></li>
            </ul>
        </nav>

    </div>

    <div class="bottom">

        <!-- Social Icons -->
        <ul class="icons">
            <li><a href="https://twitter.com/zcourts" class="icon fa-twitter"><span class="label">Twitter</span></a></li>
            <li><a href="https://www.facebook.com/zcourts" class="icon fa-facebook"><span class="label">Facebook</span></a></li>
            <li><a href="https://github.com/zcourts" class="icon fa-github"><span class="label">Github</span></a></li>
            <li><a href="mailto:site@crlog.info" class="icon fa-envelope"><span class="label">Email</span></a></li>
        </ul>

    </div>

</div>
        <!-- Main -->
        <div id="main">
            <div class="post">

  <header class="post-header">
    <h1 class="post-title">CQL : Creating a simple keyspace </h1>
    <p class="post-meta">Jun 14, 2011 • zcourts</p>
  </header>

  <article class="post-content">
    <p>I promised a few tutorials covering <a href="http://crlog.info/2011/03/29/cassandra-query-language-aka-cql-syntax/">CQL</a> examples so I&#39;m going to kick off a series to demonstrate all/most of the features of <a href="http://cassandra.apache.org">Cassandra</a>&#39;s new query language, CQL.</p>

<p>In this example we&#39;ll create a keyspace and look at the proerties available when doing so, this will demonstrate one of the key words in CQL, <a href="http://crlog.info/2011/03/29/cassandra-query-language-aka-cql-syntax/#CREATEKEYSPACE">CREATE KEYSPACE</a>. This example has been done in Java since it is one of the easiest languages to get up and running with, however the CQL statements are portable i.e. not dependent on the language you use. There is a <a href="https://github.com/nicktelford/php-cql">PHP CQL driver</a> being developed by <a href="https://github.com/nicktelford">Nick</a>, <a href="https://github.com/davegardnerisme">Dave</a>, my self and others but I&#39;ve been out for about a month pre-occupied with a few things, the guys have been making some progress so check out the driver if you&#39;re using PHP and want to use or contribute to the development.&lt;!-- more --&gt;</p>

<p>There is a Java driver that can be downloaded from <a href="http://www.apache.org/dist/cassandra/drivers/java">http://www.apache.org/dist/cassandra/drivers/java</a> but it is not required for this tutorial. In a later tutorial I&#39;ll provide examples of using the new &quot;Cassandra Drivers&quot;, but for now I&#39;m just going to use the new execute_cql_query method provided with thrift. This way, if you&#39;re using a language that does not yet have a driver you can still get started with CQL.</p>
<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="n">cql</span><span class="o">.</span><span class="na">tests</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.io.UnsupportedEncodingException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.nio.ByteBuffer</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.cassandra.thrift.Cassandra</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.cassandra.thrift.Compression</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.cassandra.thrift.InvalidRequestException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.cassandra.thrift.NotFoundException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.cassandra.thrift.SchemaDisagreementException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.cassandra.thrift.TimedOutException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.cassandra.thrift.UnavailableException</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.apache.thrift.transport.TTransport</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.thrift.transport.TFramedTransport</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.thrift.transport.TSocket</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.thrift.protocol.TProtocol</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.thrift.protocol.TBinaryProtocol</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.thrift.TException</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">CqlTests</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="n">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span>
            <span class="kd">throws</span> <span class="n">TException</span><span class="o">,</span> <span class="n">InvalidRequestException</span><span class="o">,</span> <span class="n">UnavailableException</span><span class="o">,</span> <span class="n">UnsupportedEncodingException</span><span class="o">,</span> <span class="n">NotFoundException</span><span class="o">,</span> <span class="n">TimedOutException</span><span class="o">,</span> <span class="n">SchemaDisagreementException</span> <span class="o">{</span>
        <span class="n">TTransport</span> <span class="n">tr</span> <span class="o">=</span> <span class="k">new</span> <span class="n">TFramedTransport</span><span class="o">(</span><span class="k">new</span> <span class="n">TSocket</span><span class="o">(</span><span class="s">"localhost"</span><span class="o">,</span> <span class="mi">9160</span><span class="o">));</span>
        <span class="n">TProtocol</span> <span class="n">proto</span> <span class="o">=</span> <span class="k">new</span> <span class="n">TBinaryProtocol</span><span class="o">(</span><span class="n">tr</span><span class="o">);</span>
        <span class="n">Cassandra</span><span class="o">.</span><span class="na">Client</span> <span class="n">client</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Cassandra</span><span class="o">.</span><span class="na">Client</span><span class="o">(</span><span class="n">proto</span><span class="o">);</span>
        <span class="n">tr</span><span class="o">.</span><span class="na">open</span><span class="o">();</span>
        <span class="n">String</span> <span class="n">cql</span><span class="o">=</span><span class="s">"CREATE keyspace test1 WITH strategy_options:DC1 = '1' AND replication_factor = '1' AND strategy_class = 'NetworkTopologyStrategy'"</span><span class="o">;</span>
        <span class="c1">//create our test keyspace to use</span>
             <span class="n">client</span><span class="o">.</span><span class="na">execute_cql_query</span><span class="o">(</span><span class="n">ByteBuffer</span><span class="o">.</span><span class="na">wrap</span><span class="o">(</span><span class="n">cql</span><span class="o">.</span><span class="na">getBytes</span><span class="o">()),</span> <span class="n">Compression</span><span class="o">.</span><span class="na">NONE</span><span class="o">);</span>
        <span class="n">tr</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span><span class="err">```</span>

<span class="nl">CQL:</span><span class="err"> </span><span class="n">CREATE</span> <span class="n">keyspace</span> <span class="n">test1</span> <span class="n">WITH</span> <span class="nl">strategy_options:</span><span class="n">DC1</span> <span class="o">=</span> <span class="sc">'1'</span> <span class="n">AND</span> <span class="n">replication_factor</span> <span class="o">=</span> <span class="sc">'1'</span> <span class="n">AND</span> <span class="n">strategy_class</span> <span class="o">=</span> <span class="err">'</span><span class="n">NetworkTopologyStrategy</span><span class="err">'</span>


<span class="err">##</span> <span class="n">CREATE</span><span class="err"> </span><span class="n">KEYSPACE</span>


<span class="nl">_Synopsis:</span><span class="n">_</span>


    <span class="o">&lt;</span><span class="n">code</span><span class="o">&gt;</span> <span class="n">CREATE</span> <span class="n">KEYSPACE</span> <span class="o">&lt;</span><span class="n">NAME</span><span class="o">&gt;</span> <span class="n">WITH</span> <span class="n">AND</span> <span class="n">strategy_class</span> <span class="o">=</span> <span class="o">&lt;</span><span class="n">STRATEGY</span><span class="o">&gt;</span> <span class="n">AND</span> <span class="n">strategy_options</span><span class="o">.&lt;</span><span class="n">OPTION</span><span class="o">&gt;</span> <span class="o">=</span> <span class="o">&lt;</span><span class="n">VALUE</span><span class="o">&gt;</span> <span class="o">[</span><span class="n">AND</span> <span class="n">strategy_options</span><span class="o">.&lt;</span><span class="n">OPTION</span><span class="o">&gt;</span> <span class="o">=</span> <span class="o">&lt;</span><span class="n">VALUE</span><span class="o">&gt;];&lt;/</span><span class="n">code</span><span class="o">&gt;</span>


<span class="n">The</span><span class="err"> `</span><span class="n">CREATE</span> <span class="n">KEYSPACE</span><span class="err">` </span><span class="n">statement</span> <span class="n">creates</span> <span class="n">a</span> <span class="k">new</span> <span class="n">top</span><span class="o">-</span><span class="n">level</span> <span class="n">namespace</span> <span class="o">(</span><span class="n">aka</span> <span class="err">“</span><span class="n">keyspace</span><span class="err">”</span><span class="o">).</span> <span class="n">Valid</span> <span class="n">names</span> <span class="n">are</span> <span class="n">any</span> <span class="n">string</span> <span class="n">constructed</span> <span class="n">of</span> <span class="n">alphanumeric</span> <span class="n">characters</span> <span class="n">and</span> <span class="n">underscores</span><span class="o">,</span> <span class="n">but</span> <span class="n">must</span> <span class="n">begin</span> <span class="n">with</span> <span class="n">a</span> <span class="n">letter</span><span class="o">.</span> <span class="n">Properties</span> <span class="n">such</span> <span class="n">as</span> <span class="n">replication</span> <span class="n">strategy</span> <span class="n">and</span> <span class="n">count</span> <span class="n">are</span> <span class="n">specified</span> <span class="n">during</span> <span class="n">creation</span> <span class="n">using</span> <span class="n">the</span> <span class="n">following</span> <span class="n">accepted</span> <span class="n">keyword</span> <span class="nl">arguments:</span>
<span class="o">&lt;</span><span class="n">table</span> <span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">tbody</span> <span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">tr</span> <span class="o">&gt;</span>
<span class="n">keyword</span>
<span class="n">required</span>
<span class="n">description</span>
<span class="o">&lt;/</span><span class="n">tr</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">tr</span> <span class="o">&gt;</span>

<span class="o">&lt;</span><span class="n">td</span> <span class="o">&gt;</span><span class="n">strategy_options</span>
<span class="o">&lt;/</span><span class="n">td</span><span class="o">&gt;</span>

<span class="o">&lt;</span><span class="n">td</span> <span class="o">&gt;</span><span class="n">no</span>
<span class="o">&lt;/</span><span class="n">td</span><span class="o">&gt;</span>

<span class="o">&lt;</span><span class="n">td</span> <span class="o">&gt;</span><span class="n">Most</span> <span class="n">strategies</span> <span class="n">require</span> <span class="n">additional</span> <span class="n">arguments</span> <span class="n">which</span> <span class="n">can</span> <span class="n">be</span> <span class="n">supplied</span> <span class="n">by</span> <span class="n">appending</span> <span class="n">the</span> <span class="n">option</span> <span class="n">name</span> <span class="n">to</span> <span class="n">the</span><span class="err"> `</span><span class="n">strategy_options</span><span class="err">` </span><span class="n">keyword</span><span class="o">,</span> <span class="n">separated</span> <span class="n">by</span> <span class="n">a</span> <span class="n">colon</span> <span class="o">(</span><span class="err">`</span><span class="o">:</span><span class="err">`</span><span class="o">).</span> <span class="n">For</span> <span class="n">example</span><span class="o">,</span> <span class="n">a</span> <span class="n">strategy</span> <span class="n">option</span> <span class="n">of</span> <span class="err">“</span><span class="n">DC1</span><span class="err">”</span> <span class="n">with</span> <span class="n">a</span> <span class="n">value</span> <span class="n">of</span> <span class="err">“</span><span class="mi">1</span><span class="err">”</span> <span class="n">would</span> <span class="n">be</span> <span class="n">specified</span> <span class="n">as</span><span class="err"> `</span><span class="nl">strategy_options:</span><span class="n">DC1</span> <span class="o">=</span> <span class="mi">1</span><span class="err">`</span><span class="o">;</span> <span class="n">replication_factor</span> <span class="k">for</span> <span class="n">SimpleStrategy</span> <span class="n">could</span> <span class="n">be</span><span class="err">`</span><span class="nl">strategy_options:</span><span class="n">replication_factor</span><span class="o">=</span><span class="mi">3</span><span class="err">`</span><span class="o">.</span>
<span class="o">&lt;/</span><span class="n">td</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">tr</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">tbody</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">table</span><span class="o">&gt;</span>
<span class="n">The</span> <span class="n">above</span> <span class="n">is</span> <span class="n">the</span> <span class="n">doc</span> <span class="n">from</span> <span class="n">the</span><span class="err"> </span><span class="o">[</span><span class="n">CQL</span> <span class="n">v1</span><span class="o">.</span><span class="mi">0</span> <span class="n">specification</span><span class="o">](</span><span class="nl">http:</span><span class="c1">//crlog.info/2011/06/13/cassandra-query-language-cql-v1-0-0-updated/), specifically [http://crlog.info/2011/06/13/cassandra-query-language-cql-v1-0-0-updated/#CREATE+KEYSPACE](http://crlog.info/2011/06/13/cassandra-query-language-cql-v1-0-0-updated/#CREATE+KEYSPACE).</span>
<span class="n">The</span> <span class="n">specs</span> <span class="n">says</span> <span class="n">strategy_options</span> <span class="n">is</span> <span class="n">not</span> <span class="n">required</span><span class="o">,</span> <span class="n">however</span> <span class="n">in</span> <span class="n">the</span> <span class="mf">0.8</span><span class="o">.</span><span class="mi">0</span> <span class="n">version</span> <span class="n">being</span> <span class="n">shipped</span> <span class="n">at</span> <span class="n">the</span> <span class="n">time</span> <span class="n">of</span> <span class="n">writing</span> <span class="n">a</span> <span class="n">keyspace</span> <span class="n">cannot</span> <span class="n">be</span> <span class="n">created</span> <span class="n">without</span> <span class="n">specifying</span> <span class="n">the</span> <span class="n">properties</span> <span class="n">that</span> <span class="n">were</span> <span class="n">required</span> <span class="n">in</span> <span class="n">the</span> <span class="n">old</span> <span class="n">specification</span><span class="o">,</span> <span class="n">namely</span><span class="err"> </span><span class="n">strategy_class</span> <span class="n">and</span> <span class="n">the</span> <span class="n">replication_factor</span> <span class="n">properties</span><span class="err"> </span><span class="o">[</span><span class="nl">http:</span><span class="c1">//crlog.info/2011/03/29/cassandra-query-language-aka-cql-syntax/#CREATEKEYSPACE](http://crlog.info/2011/03/29/cassandra-query-language-aka-cql-syntax/#CREATEKEYSPACE). This issue is addressed in Cassandra versions greater than 0.8.0 - Currently not available for download on the main download page but can be checked out from trunk and built. The easiest option is to simply specify the required properties, otherwise you'll get an exception which looks similar to:</span>

<span class="err">```</span><span class="n">java</span>
<span class="n">Exception</span> <span class="n">in</span> <span class="n">thread</span> <span class="s">"main"</span> <span class="n">InvalidRequestException</span><span class="o">(</span><span class="nl">why:</span><span class="n">missing</span> <span class="n">required</span> <span class="n">argument</span> <span class="s">"strategy_class"</span><span class="o">)</span>
    <span class="n">at</span> <span class="n">org</span><span class="o">.</span><span class="na">apache</span><span class="o">.</span><span class="na">cassandra</span><span class="o">.</span><span class="na">thrift</span><span class="o">.</span><span class="na">Cassandra</span><span class="n">$execute_cql_query_result</span><span class="o">.</span><span class="na">read</span><span class="o">(</span><span class="n">Cassandra</span><span class="o">.</span><span class="na">java</span><span class="o">:</span><span class="mi">30983</span><span class="o">)</span>
    <span class="n">at</span> <span class="n">org</span><span class="o">.</span><span class="na">apache</span><span class="o">.</span><span class="na">cassandra</span><span class="o">.</span><span class="na">thrift</span><span class="o">.</span><span class="na">Cassandra</span><span class="n">$Client</span><span class="o">.</span><span class="na">recv_execute_cql_query</span><span class="o">(</span><span class="n">Cassandra</span><span class="o">.</span><span class="na">java</span><span class="o">:</span><span class="mi">1708</span><span class="o">)</span>
    <span class="n">at</span> <span class="n">org</span><span class="o">.</span><span class="na">apache</span><span class="o">.</span><span class="na">cassandra</span><span class="o">.</span><span class="na">thrift</span><span class="o">.</span><span class="na">Cassandra</span><span class="n">$Client</span><span class="o">.</span><span class="na">execute_cql_query</span><span class="o">(</span><span class="n">Cassandra</span><span class="o">.</span><span class="na">java</span><span class="o">:</span><span class="mi">1682</span><span class="o">)</span>
</code></pre></div>
  </article>

</div>

        </div>
        <!-- Footer -->
<div id="footer">
    <!-- Copyright -->
    <ul class="copyright">
        <li><a href="http://zcourts.com">&copy; zcourts</a></li>
        <li>i.e. &copy; Courtney Robinson. All rights reserved.</li>
    </ul>

</div>
        <script>
            (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
                (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
                    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
            })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

            ga('create', 'UA-46289473-4', 'auto');
            ga('require', 'linkid', 'linkid.js');
            ga('send', 'pageview');

        </script>
    </body>
</html>
