<!DOCTYPE html>
<html>
        <head>
    <title>Building RPMs on Windows</title>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta name="description" content="I finally got tired of build RPMs in a VM. Its ridiculously slow because its done on a shared Windows partition.I started looking around to see if it was pos...">
    <meta name="keywords" content="" />
    <script src="/js/jquery.min.js"></script>
    <script src="/js/init.js"></script>

    <link rel="stylesheet" href="/css/main.css">

    <link rel="canonical" href="//2012/09/11/building-rpms-on-windows">
    <link rel="alternate" type="application/atom+xml" title="zcourts AKA Courtney Robinson" href="/feed.xml" />
</head>
    <body>
        <!-- Header -->
<div id="header" class="skel-layers-fixed">

    <div class="top">

        <!-- Logo -->
        <div id="logo">
            <span class="image avatar48"><img src="/images/avatar.jpg" alt=""/></span>

            <h1 id="title">zcourts</h1>
            <p>Courtney Robinson</p>
            <p>Software Engineer</p>
            <p>PhD Student</p>
        </div>

        <!-- Nav -->
        <nav id="nav">
            <!--

                Prologue's nav expects links in one of two formats:

                1. Hash link (scrolls to a different section within the page)

                   <li><a href="#foobar" id="foobar-link" class="icon fa-whatever-icon-you-want skel-layers-ignoreHref"><span class="label">Foobar</span></a></li>

                2. Standard link (sends the user to another page/site)

                   <li><a href="http://foobar.tld" id="foobar-link" class="icon fa-whatever-icon-you-want"><span class="label">Foobar</span></a></li>

            -->
            <ul>
                <li><a href="/#top" id="top-link" class="skel-layers-ignoreHref"><span class="icon fa-home">Home</span></a></li>
                <li><a href="/#portfolio" id="portfolio-link" class="skel-layers-ignoreHref"><span class="icon fa-th">Projects</span></a></li>
                <li><a href="/posts" id="blog-link" class="skel-layers-ignoreHref"><span class=" glyphicon glyphicon-comment">Blog posts</span></a></li>
                <li><a href="/categories.html" id="cat-link" class="skel-layers-ignoreHref"><span class=" glyphicon glyphicon-tags">Categories</span></a></li>
                <li><a href="/about-courtney-robinson" id="about-link" class="skel-layers-ignoreHref"><span class="icon fa-user">About Me</span></a></li>
                <li><a href="/#contact" id="contact-link" class="skel-layers-ignoreHref"><span class="icon fa-envelope">Contact</span></a></li>
            </ul>
        </nav>

    </div>

    <div class="bottom">

        <!-- Social Icons -->
        <ul class="icons">
            <li><a href="https://twitter.com/zcourts" class="icon fa-twitter"><span class="label">Twitter</span></a></li>
            <li><a href="https://www.facebook.com/zcourts" class="icon fa-facebook"><span class="label">Facebook</span></a></li>
            <li><a href="https://github.com/zcourts" class="icon fa-github"><span class="label">Github</span></a></li>
            <li><a href="mailto:site@crlog.info" class="icon fa-envelope"><span class="label">Email</span></a></li>
        </ul>

    </div>

</div>
        <!-- Main -->
        <div id="main">
            <div class="post">

    <header class="post-header">
        <h1 class="post-title">Building RPMs on Windows</h1>

        <p class="post-meta">Sep 11, 2012 • zcourts
            </p>
    </header>

    <article class="post-content">
        <p>I finally got tired of build RPMs in a VM. Its ridiculously slow because its done on a shared Windows partition.
I started looking around to see if it was possible, all indications where that it hasn&#39;t really been done...
I found a few Java libraries that allows you to manipulate RPM files but using them would require writing a maven plugin before I can get anything done...<strong> </strong>Have a look at <a href="http://jrpm.sourceforge.net/">http://jrpm.sourceforge.net/</a> and <a href="http://redline-rpm.org/">http://redline-rpm.org/</a> to see what if they&#39;re useful for you...</p>

<p>&lt;!-- more --&gt;Using maven I&#39;ve configured the Maven RPM plugin (see <a href="http://mojo.codehaus.org/rpm-maven-plugin/">http://mojo.codehaus.org/rpm-maven-plugin/</a>) to generate an RPM from my project. I&#39;ll include the POM section for that in a while. To get started however you need Cygwin installed...</p>

<p>Visit <a href="http://cygwin.com/">http://cygwin.com/</a> , download and install setup.exe. On the screen which asks you to select packages to be installed search for &quot;RPM&quot;</p>

<p><a href="http://crlog.files.wordpress.com/2012/09/rpm-install.png"><img src="http://crlog.files.wordpress.com/2012/09/rpm-install.png" alt=""></a></p>

<p>Install the three packages as shown above in the screenshot, <strong>rpm</strong>,<strong>rpmbuild</strong> and optionally <strong>rpm-doc</strong>.
Also ensure the packages <strong>libintl2</strong> and <strong>sed</strong> are selected for installation.</p>

<p>If you already have Cygwin installed then just re-run setup.exe and add the packages above as necessary.</p>

<p>The next thing to do is identify your cygwin bin directory. For example, I installed Cygwin in &quot;<strong>C:\bin\cygwin</strong><strong>&quot; </strong>So my  cygwin bin directory is &quot;<strong>C:\bin\cygwin\bin</strong>&quot;.</p>

<p>Add this directory to the system path. (Start -&gt; Right click &quot;Computer&quot; -&gt;Properties -&gt; Advanced System settings -&gt; Environment variables and under &quot;System paths&quot;, append the directory to the &quot;Path&quot; variable.)</p>

<p>In that folder create a file called <strong>rpmbuild.bat </strong>and add the following contents to that file:</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash">SETLOCAL
PUSHD .

REM Update buildroot path
FOR /F <span class="s2">"tokens=*"</span> %%i <span class="k">in</span> <span class="o">(</span><span class="s1">'cygpath %3'</span><span class="o">)</span> <span class="k">do </span>SET <span class="nv">NEW_BUILDROOT</span><span class="o">=</span>%%i

REM Update topdir path
SET <span class="nv">TOPDIR</span><span class="o">=</span>%5
SET <span class="nv">TOPDIR</span><span class="o">=</span>%TOPDIR:~9,-1%
FOR /F <span class="s2">"tokens=*"</span> %%i <span class="k">in</span> <span class="o">(</span><span class="s1">'cygpath "%TOPDIR%"'</span><span class="o">)</span> <span class="k">do </span>SET <span class="nv">NEW_TOPDIR</span><span class="o">=</span>%%i

REM Replace path <span class="k">in </span>spec-file
SET <span class="nv">OLD_PATH</span><span class="o">=</span>%TOPDIR:<span class="se">\=\\</span>%
SET <span class="nv">NEW_PATH</span><span class="o">=</span>%NEW_TOPDIR:/<span class="o">=</span><span class="se">\/</span>%

REM Original sed <span class="nb">command
</span>REM sed -s -i -e s/%OLD_PATH%<span class="se">\\</span>/%NEW_PATH%<span class="se">\/</span>/g %8

REM replace <span class="se">\ </span>with / i.e. escape <span class="se">\\</span> replace with escape <span class="se">\/</span>
sed -s -i -e s/<span class="se">\\</span>/<span class="se">\/</span>/g %8

REM Execute rpmbuild

bash -c <span class="s2">"rpmbuild %1 %2 %NEW_BUILDROOT% %4 ""_topdir %NEW_TOPDIR%"" %6 "</span>%7<span class="s2">" --define ""_build_name_fmt %%{ARCH}/%%{NAME}-%%{VERSION}-%%{RELEASE}.%%{ARCH}.rpm"" %8"</span>

POPD
ENDLOCAL
</code></pre></div>
<p>NOTE: I didn&#39;t write it, I found it when I ran into issues trying to get my RPM setup to work see <a href="https://jira.codehaus.org/browse/MRPM-4">https://jira.codehaus.org/browse/MRPM-4</a> for the original source.
The above script replaces backslashes in the spec file generated with Windows paths.
It then executes the &quot;real rpmbuild&quot; using Cygwin&#39;s bash (to provide a linuxish environment)...</p>

<p>This executes fairly quickly and writes the RPM as expected.</p>

    </article>
    <footer class="post-footer">
        <div id="disqus_thread"></div>
        <script type="text/javascript">
            /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
            var disqus_shortname = 'zcourts'; // required: replace example with your forum shortname

            /* * * DON'T EDIT BELOW THIS LINE * * */
            (function () {
                var dsq = document.createElement('script');
                dsq.type = 'text/javascript';
                dsq.async = true;
                dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
            })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by
            Disqus.</a></noscript>
    </footer>
</div>

        </div>
        <!-- Footer -->
<div id="footer">
    <!-- Copyright -->
    <ul class="copyright">
        <li><a href="http://zcourts.com">&copy; zcourts</a></li>
        <li>i.e. &copy; Courtney Robinson. All rights reserved.</li>
    </ul>

</div>
        <div class="addthis_toolbox addthis_default_style " id="addthisURL" addthis:url=""></div>
        <script>
            (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
                (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
                    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
            })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

            ga('create', 'UA-46289473-4', 'auto');
            ga('require', 'linkid', 'linkid.js');
            ga('send', 'pageview');
            document.getElementById("addthisURL").setAttribute("addthis:url",window.location.href);
        </script>
        <script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=zcourts" async="async"></script>
    </body>
</html>
